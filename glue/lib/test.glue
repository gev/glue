
(module test
    (import bool)
    (import io)

    (export assert test assert-equal)

    ;; Helper for test failure handling
    (def handle-test-failure
        (lambda (name e)
            (if (= e.type "assert-equal")
                (println "Test" name "failed: Expected" e.expected "but got" e.actual)
                (println "Test" name "failed:" e))
            "failed"))

    ;; Helper for test success handling
    (def make-success-handler
        (lambda (name)
            (lambda (result)
                (if (!= result "failed")
                    (println "Test" name "passed")))))

    ;; Assert that a condition is true, otherwise throw error with message
    (def assert
        (lambda (condition message)
            (if (not condition)
                (error test-failure message))))

    ;; Run a test thunk, catch errors and print results
    (def test
        (lambda (name thunk)
            ((make-success-handler name)
                (try thunk (catch test-failure (handle-test-failure name))))))

    ;; Assert two values are equal
    (def assert-equal
        (lambda (expected actual)
            (assert (= expected actual)
                (:type "assert-equal" :expected expected :actual actual))))
